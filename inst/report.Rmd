---
output: 
  html_document:
    df_print: paged
params:
  df_diff: NULL
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE,
                      rownames.print = FALSE, rows.print = 10,
                      fig.height = 6, fig.width = 9)
knitr::knit_hooks$set(width=local({
    .width <- 0
    function(before, options, envir) {
        if (before) .width <<- options(width=options$width)
        else options(.width)
    }
}))
library(different)
```

```{r diff-from-params, include = FALSE}
stopifnot(!is.null(df_diff))
df_diff <- params$df_diff
```

# Differences Report {.tabset}

## Summary

```{r summary, comment="", width=90}
summary(df_diff)
```

## Visualization

```{r visualization, out.width="100%"}
plot(df_diff)
```

## Differences by Column {.tabset .tabset-fade .tabset-pills}

```{r diffs-by-column, include=FALSE}
out <- vector(mode = "character", length = length(df_diff$tidy))
for (colname in names(df_diff$tidy)) {
  out[[colname]] <- knitr::knit_expand(
    text = c(
      "### {{colname}}",
      "```{r, echo = FALSE}",
      "x <- df_diff$tidy[['{{colname}}']]",
      "colnames(x)[2:3] <- df_diff$meta$names",
      "x",
      "```")
  )
}
```

`r paste(knitr::knit(text = out), collapse = "\n")`
