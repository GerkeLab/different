---
output: 
  html_document:
    df_print: paged
params:
  df_ref: NULL
  df_cmp: NULL
  df_names: NULL
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE,
                      rownames.print = FALSE, rows.print = 10)
knitr::knit_hooks$set(width=local({
    .width <- 0
    function(before, options, envir) {
        if (before) .width <<- options(width=options$width)
        else options(.width)
    }
}))
library(different)
```

```{r}
df_ref <- params$df_ref
df_cmp <- params$df_cmp
df_diff <- tidy_diff(df_ref, df_cmp)
```

# Differences Report {.tabset}

## Summary

```{r summary, comment="", width=90}
summary(df_diff)
```

## Visualization

```{r visualization}
plot(df_diff)
```

## Differences by Column {.tabset .tabset-fade .tabset-pills}

```{r diffs-by-column, include=FALSE}
out <- vector(mode = "character", length = length(df_diff$tidy))
for (colname in names(df_diff$tidy)) {
  out[[colname]] <- knitr::knit_expand(
    text = c(
      "### {{colname}}",
      "```{r, echo = FALSE}",
      "df_diff$tidy[['{{colname}}']]",
      "```")
  )
}
```

`r paste(knitr::knit(text = out), collapse = "\n")`
